function e(t){return t.map(t=>Array.isArray(t)?e(t):t)}const t=new class{constructor(){this.board=Array.from({length:4},()=>[,,,,].fill(0)),this.score=0,this.status="idle"}getState(){return e(this.board)}getScore(){return this.score}getStatus(){let e=!1,t=!1;for(let s=0;s<4;s++)for(let r=0;r<4;r++){let i=this.board[s][r];if(2048===i)return this.status="win";0===i&&(e=!0),(r<3&&i===this.board[s][r+1]||s<3&&i===this.board[s+1][r])&&(t=!0)}return e||t?this.status="playing":this.status="lose"}addRandomTile(){let e=[];for(let t=0;t<4;t++)for(let s=0;s<4;s++)0===this.board[t][s]&&e.push({row:t,col:s});if(0===e.length)return;let{row:t,col:s}=e[Math.floor(Math.random()*e.length)];this.board[t][s]=.9>Math.random()?2:4,this.newTiles=[{row:t,col:s}]}shiftAndCombine(e,t=null,s=!1){let r=e.filter(e=>0!==e),i=[];for(let e=0;e<r.length-1;e++)r[e]===r[e+1]&&(r[e]*=2,this.score+=r[e],r[e+1]=0,null!==t&&(s?i.push({row:e,col:t}):i.push({row:t,col:e})));for(r=r.filter(e=>0!==e);r.length<4;)r.push(0);return this.mergedTiles=(this.mergedTiles||[]).concat(i),r}move(t){if("idle"===this.status)return;let s=!1,r=e(this.board);this.newTiles=[],this.mergedTiles=[];let i=e=>this.board.map(t=>t[e]),o=(e,t)=>t.forEach((t,s)=>this.board[s][e]=t);for(let e=0;e<4;e++){let a;switch(t){case"left":a=this.board[e],a=this.shiftAndCombine(a,e,!1),this.board[e]=a;break;case"right":a=[...this.board[e]].reverse(),a=this.shiftAndCombine(a,e,!1).reverse(),this.board[e]=a;break;case"up":a=i(e),a=this.shiftAndCombine(a,e,!0),o(e,a);break;case"down":a=i(e).reverse(),a=this.shiftAndCombine(a,e,!0).reverse(),o(e,a)}s||r[e].join()===this.board[e].join()||(s=!0)}s&&this.addRandomTile()}start(){this.board=Array.from({length:4},()=>[,,,,].fill(0)),this.score=0,this.status="playing",this.addRandomTile(),this.addRandomTile()}restart(){this.board=Array.from({length:4},()=>[,,,,].fill(0)),this.score=0,this.status="idle"}},s=document.querySelector(".game-score"),r=document.querySelectorAll(".field-cell"),i=document.querySelector(".message-start"),o=document.querySelector(".message-lose"),a=document.querySelector(".message-win"),d=document.querySelector(".button.start"),l=document.querySelector(".button.restart");function n(){s.textContent=t.getScore(),"lose"===t.status&&o.classList.remove("hidden"),"win"===t.status&&a.classList.remove("hidden"),t.board.forEach((e,s)=>{e.forEach((e,i)=>{let o=r[4*s+i];o.textContent=0!==e?e:"",o.className="field-cell",0!==e&&(o.classList.add(`field-cell--${e}`),t.newTiles?.some(e=>e.row===s&&e.col===i)&&(o.classList.add("new"),o.addEventListener("animationend",()=>{o.classList.remove("new")},{once:!0})),t.mergedTiles?.some(e=>e.row===s&&e.col===i)&&(o.classList.add("merged"),o.addEventListener("animationend",()=>{o.classList.remove("merged")},{once:!0})))})})}d.addEventListener("click",()=>{t.start(),l.classList.remove("hidden"),d.classList.add("hidden"),i.classList.add("hidden"),n()}),l.addEventListener("click",()=>{t.restart(),l.classList.add("hidden"),d.classList.remove("hidden"),i.classList.remove("hidden"),o.classList.add("hidden"),a.classList.add("hidden"),n()}),document.addEventListener("keydown",e=>{let s={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"};s[e.key]&&(t.move(s[e.key]),n(),t.getStatus())});
//# sourceMappingURL=index.c71cc97a.js.map
